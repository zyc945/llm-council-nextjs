# ============================================
# LLM Council - Development Dockerfile
# Optimized for hot-reload development
# ============================================

FROM node:20-alpine

# 安装必要的系统依赖
RUN apk add --no-cache \
    libc6-compat \
    dumb-init

WORKDIR /app

# 复制 package 文件
COPY package.json package-lock.json* ./

# 安装所有依赖（包括 devDependencies）
RUN npm ci && \
    npm cache clean --force

# 源代码通过 volume 挂载，不在这里复制

# 暴露端口
EXPOSE 3000

# 设置环境变量
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
ENV PORT=3000
ENV HOSTNAME="0.0.0.0"

# 使用 dumb-init 作为 PID 1
ENTRYPOINT ["/usr/bin/dumb-init", "--"]

# 启动开发服务器（支持热重载）
CMD ["npm", "run", "dev"]
